#!/bin/bash
# Copyright Â© 2012 Martin Ueding <dev@martin-ueding.de>

set -e
set -u
set -x

internal="LVDS1"
urt="/opt/UrbanTerror/ioUrbanTerror.x86_64"

set_dl_url() {
	# Find the current IP address for the map download.
	ifconfig=$(ifconfig | grep -v 127.0.0.1 | grep -oP 'inet Adresse:([\d\.]+)')
	ip=${ifconfig#inet Adresse:}

	echo 'sets sv_dlURL "'$ip'"' >> q3config.cfg
}

cd "$HOME/.q3a/q3ut4"

rm -f q3config.cfg

case "$1" in
	24)
		ln -s q3config-24.cfg q3config.cfg
		set_dl_url
		xrandr --output "$internal" --off
		"$urt"
		xrandr --output "$internal" --auto
		;;
	12)
		ln -s q3config-12.cfg q3config.cfg
		set_dl_url
		"$urt"
		;;
	*)
		exit 1
esac
